<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Plan de Estudios - Ingeniería Civil</title>
<style>
  :root{
    --bg1:#000000;
    --bg2:#161616;
    --accent:#d4af37; /* dorado elegante */
    --card:#111111;
    --muted:#9aa6b2;
    --glass: rgba(255,255,255,0.04);
    --shadow: 0 8px 24px rgba(2,6,23,0.6);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: radial-gradient(1200px 700px at 20% 0%, rgba(212,175,55,0.08), transparent 60%),
                linear-gradient(135deg, var(--bg1), var(--bg2));
    color: #e6eef6;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:1rem;
    padding:1rem;
  }

  header{
    width:100%;
    max-width:1600px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:1rem;
  }
  h1{
    margin:0;
    font-size:1.35rem;
    color:var(--accent);
    text-shadow:0 0 10px rgba(212,175,55,0.25);
  }

  .top-controls{
    display:flex;
    gap:0.6rem;
    align-items:center;
  }
  .btn{
    background:var(--glass);
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.06);
    padding:0.45rem 0.7rem;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    transition:transform .12s, background .12s, border-color .12s;
  }
  .btn:hover{ transform:translateY(-2px); background:rgba(255,255,255,0.06); border-color:rgba(212,175,55,0.35); }

  /* GRID 3x4 (PC) */
  .grid-wrap{
    width:100%;
    max-width:1600px;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:1rem;
  }

  .cell{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:0.9rem;
    min-height:320px;
    box-shadow: var(--shadow);
    border:1px solid rgba(255,255,255,0.06);
    display:flex;
    flex-direction:column;
  }

  .cell h2{
    margin:0 0 .6rem 0;
    color:var(--accent);
    font-size:1rem;
    text-align:center;
    padding-bottom:0.35rem;
    border-bottom:2px solid rgba(212,175,55,0.18);
  }

  .subjects{
    display:flex;
    flex-direction:column;
    gap:0.35rem;
    margin-top:0.45rem;
    overflow:auto;
    padding-right:6px;
  }

  .subject{
    background:rgba(255,255,255,0.02);
    padding:0.55rem;
    border-radius:10px;
    font-weight:700;
    font-size:0.92rem;
    text-align:center;
    cursor:pointer;
    transition: transform .12s, background .18s, border-color .12s;
    color: #d9e6f2;
    user-select:none;
    border:1px solid transparent;
  }
  .subject:hover{ transform:translateY(-4px); background:rgba(255,255,255,0.04); border-color:rgba(212,175,55,0.25); }

  .subject.locked{
    cursor:not-allowed;
    opacity:0.62;
    transform:none;
    background:rgba(255,255,255,0.015);
    color: #8a96a1;
    border-color:transparent;
  }

  /* Estado */
  .promocion{ background:#2e7d32 !important; color:#fff; }
  .regular{ background:#fdd835 !important; color:#111; }
  .libre{ background:#d32f2f !important; color:#fff; }
  .curso{ background:#0288d1 !important; color:#fff; }

  /* Scrollbar */
  .subjects::-webkit-scrollbar{ width:8px }
  .subjects::-webkit-scrollbar-thumb{ background:rgba(255,255,255,0.12); border-radius:8px }

  /* Panel de estadísticas */
  .stats{
    display:flex;
    flex-direction:column;
    gap:0.8rem;
    align-items:stretch;
    justify-content:flex-start;
  }
  .stat-row{ display:flex; align-items:center; justify-content:space-between; gap:1rem; }
  .stat-card{
    background: rgba(255,255,255,0.02);
    padding:0.6rem;
    border-radius:10px;
    flex:1;
    text-align:center;
    min-width:0;
    border:1px solid rgba(255,255,255,0.06);
  }
  .stat-card strong{ display:block; font-size:1.05rem; color:#fff; }
  .stat-label{ color:var(--muted); font-size:0.85rem; margin-top:0.3rem; }

  /* Barra de progreso */
  .progress-wrap{
    background: rgba(255,255,255,0.03);
    border-radius:12px;
    padding:0.5rem;
    border:1px solid rgba(255,255,255,0.06);
  }
  .progress{
    height:18px;
    background:rgba(0,0,0,0.25);
    border-radius:12px;
    overflow:hidden;
  }
  .progress > .fill{
    height:100%;
    width:0%;
    background: linear-gradient(90deg, #4caf50, #82c91e);
    border-radius:12px;
    transition: width .6s ease-in-out;
  }
  .progress-caption{ display:flex; justify-content:space-between; font-size:0.85rem; color:var(--muted); margin-top:0.35rem; }

  footer{
    width:100%;
    max-width:1600px;
    display:flex;
    justify-content:flex-end;
    gap:0.8rem;
  }

  /* Responsive */
  @media (max-width:1200px){
    .grid-wrap{ grid-template-columns: repeat(2, 1fr); }
    .cell{ min-height:260px }
  }
  @media (max-width:900px){
    header{ padding:0 .5rem; gap:0.4rem; align-items:flex-start; flex-direction:column; }
    .grid-wrap{ grid-template-columns:1fr; width:100%; }
    .cell{ min-height:auto; padding:0.7rem }
  }

  .small{ font-size:0.84rem; color:var(--muted); }
  .center{ text-align:center }
  .kbd{ background:rgba(255,255,255,0.03); padding:2px 6px; border-radius:6px; font-weight:700; font-size:0.82rem; color:var(--muted) }
</style>
</head>
<body>

<header>
  <h1>Malla - Ingeniería Civil</h1>
  <div class="top-controls">
    <button class="btn" id="btn-reset">Reiniciar malla</button>
  </div>
</header>

<!-- GRID -->
<main class="grid-wrap" id="gridWrap">
  <!-- Cells se generan desde JS -->
</main>

<footer>
  <div class="small">Diseño responsive • Vista PC: 3x4 • Mobile: columna única</div>
</footer>

<!-- MENU flotante -->
<div id="menu" style="display:none; position:fixed; z-index:9999;" class="menu-box"></div>

<script>
/* ----------------------- DATOS DE MATERIAS ----------------------- */
const materias = [
  { id: 'ambientacion', nombre: 'Ambientación Universitaria', semestre: 1, requisitos: [] },
  { id: 'fyq', nombre: 'Física y Química', semestre: 1, requisitos: [] },
  { id: 'matematica', nombre: 'Matemática', semestre: 1, requisitos: [] },

  { id: 'am1', nombre: 'Análisis Matemático I', semestre: 2, requisitos: ['matematica'] },
  { id: 'introIng', nombre: 'Introducción a la Ingeniería', semestre: 2, requisitos: ['ambientacion'] },
  { id: 'quimica', nombre: 'Química', semestre: 2, requisitos: ['matematica', 'fyq'] },
  { id: 'economia', nombre: 'Economía', semestre: 2, requisitos: ['matematica'] },

  { id: 'algebra', nombre: 'Álgebra Lineal', semestre: 3, requisitos: ['matematica'] },
  { id: 'fisica1', nombre: 'Física I', semestre: 3, requisitos: ['fyq', 'am1'] },
  { id: 'sistRep', nombre: 'Sistemas de Representación', semestre: 3, requisitos: [] },
  { id: 'ingles', nombre: 'Módulo de Inglés', semestre: 3, requisitos: [] },

  { id: 'am2', nombre: 'Análisis Matemático II', semestre: 4, requisitos: ['am1', 'algebra'] },
  { id: 'pyestad', nombre: 'Probabilidad y Estadística', semestre: 4, requisitos: ['am1'] },
  { id: 'estatica', nombre: 'Estática', semestre: 4, requisitos: ['fisica1'] },
  { id: 'topo1', nombre: 'Topografía Básica', semestre: 4, requisitos: ['matematica', 'sistRep'] },

  { id: 'fisica2', nombre: 'Física II', semestre: 5, requisitos: ['fisica1', 'algebra'] },
  { id: 'compu', nombre: 'Computación y Cálculo Numérico', semestre: 5, requisitos: ['am1', 'algebra'] },
  { id: 'mecEstruct', nombre: 'Mecánica de las Estructuras', semestre: 5, requisitos: ['estatica', 'am2'] },
  { id: 'topo2', nombre: 'Topografía Aplicada', semestre: 5, requisitos: ['topo1'] },

  { id: 'geologia', nombre: 'Ingeniería Geológica y Geotécnica', semestre: 6, requisitos: ['fyq'] },
  { id: 'transporte1', nombre: 'Planificación y Operación del Transporte', semestre: 6, requisitos: ['pyestad', 'economia'] },
  { id: 'matConst', nombre: 'Tecnología de los Materiales', semestre: 6, requisitos: ['estatica', 'quimica'] },
  { id: 'fluido', nombre: 'Mecánica de los Fluidos', semestre: 6, requisitos: ['fisica1', 'am2'] },

  { id: 'tecConst', nombre: 'Tecnología de la Construcción', semestre: 7, requisitos: ['sistRep', 'matConst'] },
  { id: 'analisisEstruc', nombre: 'Análisis Estructural', semestre: 7, requisitos: ['mecEstruct'] },
  { id: 'suelos', nombre: 'Mecánica de Suelos y Rocas', semestre: 7, requisitos: ['estatica', 'geologia'] },
  { id: 'instSanit', nombre: 'Instalaciones Sanitarias y Eléctricas', semestre: 7, requisitos: ['fisica2'] },

  { id: 'hidro', nombre: 'Hidrología y Procesos Hidráulicos', semestre: 8, requisitos: ['fluido', 'geologia'] },
  { id: 'instGas', nombre: 'Instalaciones de Gas y Termomecánicas', semestre: 8, requisitos: ['quimica', 'instSanit'] },
  { id: 'gestionAmb', nombre: 'Ingeniería y Gestión Ambiental', semestre: 8, requisitos: ['fluido', 'quimica'] },
  { id: 'disArq', nombre: 'Diseño Arquitectónico', semestre: 8, requisitos: ['tecConst'] },
  { id: 'elasticidad', nombre: 'Elasticidad y Estructuras Laminares', semestre: 8, requisitos: ['analisisEstruc'] },

  { id: 'infraTransp', nombre: 'Diseño de Infraestructura del Transporte', semestre: 9, requisitos: ['transporte1', 'hidro', 'topo2'] },
  { id: 'hormigon', nombre: 'Hormigón Armado y Pretensado', semestre: 9, requisitos: ['mecEstruct', 'matConst'] },
  { id: 'estructMet', nombre: 'Estructuras Metálicas y de Madera', semestre: 9, requisitos: ['analisisEstruc'] },
  { id: 'legalEtica', nombre: 'Ingeniería Legal y Ética', semestre: 9, requisitos: ['topo2', 'disArq', 'introIng'] },

  { id: 'infraConstruccion', nombre: 'Construcción de Infraestructura del Transporte', semestre: 10, requisitos: ['suelos', 'infraTransp'] },
  { id: 'sanitaria', nombre: 'Ingeniería Sanitaria', semestre: 10, requisitos: ['hidro', 'quimica'] },
  { id: 'cimentaciones', nombre: 'Cimentaciones y Obras Geotécnicas', semestre: 10, requisitos: ['suelos', 'hormigon'] },
  { id: 'proyectoDir', nombre: 'Proyecto, Dirección de Obras y Valuaciones', semestre: 10, requisitos: ['economia', 'legalEtica'] },

  /* --- Último semestre (11º) --- */
  { id: 'disEstruc', nombre: 'Diseño de Estructuras', semestre: 11, requisitos: ['analisisEstruc', 'hormigon'] },
  { id: 'hidraulicas', nombre: 'Obras Hidráulicas', semestre: 11, requisitos: ['hidro', 'suelos'] },
  { id: 'higiene', nombre: 'Higiene y Seguridad', semestre: 11, requisitos: ['tecConst', 'legalEtica'] },
  { id: 'urbanismo', nombre: 'Planeamiento y Urbanismo', semestre: 11, requisitos: ['disArq', 'transporte1'] },
  /* Práctica al FINAL del último semestre */
  { id: 'practica', nombre: 'Práctica Supervisada', semestre: 11, requisitos: [], requierePorcentaje: 85 }
];

/* ----------------------- STORAGE helpers ----------------------- */
const STORAGE_KEY = 'estadosMaterias_v2';

function getEstados(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); }
  catch{ return {}; }
}
function setEstados(obj){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
}

/* ----------------------- CELDAS (3x4) ----------------------- */
const labels = [
  "Ingreso","1º Semestre","2º Semestre","3º Semestre",
  "4º Semestre","5º Semestre","6º Semestre","7º Semestre",
  "8º Semestre","9º Semestre","10º Semestre"
];

const gridWrap = document.getElementById('gridWrap');

/* Creamos 12 celdas (última = estadísticas) */
for(let i=0;i<12;i++){
  const cell = document.createElement('section');
  cell.className = 'cell';
  cell.dataset.cell = i;
  if(i < labels.length){
    cell.innerHTML = `<h2>${labels[i]}</h2><div class="subjects" data-sem="${i+1}"></div>`;
  } else {
    // panel de estadísticas en la última celda
    cell.innerHTML = `<h2>Panel de estadísticas</h2>
      <div class="stats" id="panelStats">
        <div class="stat-row">
          <div class="stat-card"><strong id="countProm">0</strong><div class="stat-label">Promocionadas</div></div>
          <div class="stat-card"><strong id="countReg">0</strong><div class="stat-label">Regulares</div></div>
        </div>
        <div class="stat-row">
          <div class="stat-card"><strong id="countLib">0</strong><div class="stat-label">Libres</div></div>
          <div class="stat-card"><strong id="countCur">0</strong><div class="stat-label">En curso</div></div>
        </div>

        <div class="progress-wrap">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <div class="small">Progreso de la carrera</div>
            <div class="small" id="pctText">0%</div>
          </div>
          <div class="progress" aria-hidden="true" style="margin-top:8px;">
            <div class="fill" id="progressFill" style="width:0%"></div>
          </div>
          <div class="progress-caption">
            <div class="small" id="captionLeft">0 materias promocionadas</div>
            <div class="small" id="totalMateriasText"></div>
          </div>
        </div>

        <div style="display:flex; gap:8px; justify-content:space-between; align-items:center;">
          <button class="btn" id="btn-reset-panel" title="Borrar todos los estados">Resetear estados</button>
          <div class="small center">Cambios guardados automáticamente</div>
        </div>
      </div>`;
  }
  gridWrap.appendChild(cell);
}

/* ----------------------- RENDER MATERIAS EN SU SEMESTRE ----------------------- */
function placeSubjects(){
  document.querySelectorAll('.subjects').forEach(s => s.innerHTML = '');
  materias.forEach(m => {
    const container = document.querySelector(`.subjects[data-sem='${m.semestre}']`);
    if(!container) return;
    const d = document.createElement('div');
    d.className = 'subject';
    d.textContent = m.nombre;
    d.dataset.id = m.id;
    container.appendChild(d);
  });
}

/* ----------------------- LÓGICA DE BLOQUEO Y ESTADOS ----------------------- */
/* % aprobadas (promoción o regular) -> solo para habilitar "práctica" por requisito */
function porcentajeAprobadasParaRequisito(){
  const estados = getEstados();
  const total = materias.filter(m => m.id !== 'practica').length;
  const aprobadas = Object.values(estados).filter(e => e === 'promocion' || e === 'regular').length;
  return (aprobadas / total) * 100;
}

function updateUI(){
  const estados = getEstados();
  document.querySelectorAll('.subject').forEach(el => {
    const id = el.dataset.id;
    el.className = 'subject';
    const mat = materias.find(x=>x.id===id);
    const estado = estados[id];
    let bloqueada = false;

    if(mat.requierePorcentaje){
      if(porcentajeAprobadasParaRequisito() < mat.requierePorcentaje) bloqueada = true;
    } else {
      const faltan = mat.requisitos.filter(r => {
        const est = estados[r];
        return !(est === 'promocion' || est === 'regular');
      });
      if(faltan.length > 0) bloqueada = true;
    }

    if(bloqueada && !estado) el.classList.add('locked');
    if(estado) el.classList.add(estado);
  });

  updateStatsUI();
}

/* ----------------------- MENÚ FLOTANTE PARA ASIGNAR ESTADO ----------------------- */
const menu = document.getElementById('menu');

function openMenuFor(element, clientX, clientY){
  const id = element.dataset.id;
  menu.style.display = 'block';
  menu.innerHTML = `
    <div class="menu" style="background:transparent; padding:0;">
      <div style="background:var(--card); border-radius:8px; padding:6px; min-width:180px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,0.06);">
        <div data-estado="promocion" class="menu-item btn" style="display:block; width:100%; margin-bottom:6px; text-align:left;">Promoción</div>
        <div data-estado="regular" class="menu-item btn" style="display:block; width:100%; margin-bottom:6px; text-align:left;">Regular</div>
        <div data-estado="libre" class="menu-item btn" style="display:block; width:100%; margin-bottom:6px; text-align:left;">Libre</div>
        <div data-estado="curso" class="menu-item btn" style="display:block; width:100%; margin-bottom:6px; text-align:left;">En curso</div>
        <div data-estado="ninguno" class="menu-item btn" style="display:block; width:100%; text-align:left;">Quitar estado</div>
      </div>
    </div>
  `;
  const pad = 8;
  const mw = 220;
  let left = clientX;
  let top = clientY;
  if(left + mw > window.innerWidth - pad) left = window.innerWidth - mw - pad;
  if(top + 220 > window.innerHeight - pad) top = window.innerHeight - 220 - pad;
  menu.style.left = left + 'px';
  menu.style.top = top + 'px';

  menu.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', () => {
      const estado = item.dataset.estado;
      const estados = getEstados();
      if(estado === 'ninguno') delete estados[id];
      else estados[id] = estado;
      setEstados(estados);
      closeMenu();
      updateUI();
    });
  });

  setTimeout(()=>{ window.addEventListener('click', outClick); }, 0);

  function outClick(ev){
    if(!menu.contains(ev.target) && ev.target !== element){
      closeMenu();
    }
  }
  function onEsc(e){ if(e.key === 'Escape') closeMenu(); }
  window.addEventListener('keydown', onEsc);

  function closeMenu(){
    menu.style.display = 'none';
    menu.innerHTML = '';
    window.removeEventListener('click', outClick);
    window.removeEventListener('keydown', onEsc);
  }
}

/* ----------------------- EVENTOS SOBRE CADA MATERIA ----------------------- */
function attachEventsToSubjects(){
  document.querySelectorAll('.subject').forEach(el => {
    el.onclick = (e) => {
      const id = el.dataset.id;
      const estados = getEstados();
      if(el.classList.contains('locked') && !estados[id]) return;
      openMenuFor(el, e.clientX + 4, e.clientY + 4);
    };
  });
}

/* ----------------------- ESTADÍSTICAS Y PROGRESO ----------------------- */
function updateStatsUI(){
  const estados = getEstados();
  const counts = { promocion:0, regular:0, libre:0, curso:0 };
  Object.values(estados).forEach(v => {
    if(counts[v] !== undefined) counts[v]++;
  });

  // total materias para progreso (excluye práctica)
  const total = materias.filter(m=>m.id !== 'practica').length;
  const promo = counts.promocion; // SOLO promocionadas suman al progreso
  const pct = (promo / total) * 100;

  document.getElementById('countProm').textContent = counts.promocion;
  document.getElementById('countReg').textContent = counts.regular;
  document.getElementById('countLib').textContent = counts.libre;
  document.getElementById('countCur').textContent = counts.curso;

  const pctText = document.getElementById('pctText');
  const fill = document.getElementById('progressFill');
  const totalText = document.getElementById('totalMateriasText');

  // Dos decimales y coma
  pctText.textContent = pct.toFixed(2).replace('.', ',') + '%';
  fill.style.width = pct + '%';

  const captionLeft = document.getElementById('captionLeft');
  if(captionLeft) captionLeft.textContent = `${promo} materias promocionadas`;
  if(totalText) totalText.textContent = `${total} materias totales`;

  // Accesibilidad
  fill.setAttribute('aria-valuenow', pct.toFixed(2));
  fill.setAttribute('aria-valuemin', 0);
  fill.setAttribute('aria-valuemax', 100);
}

/* ----------------------- BOTONES: RESET ----------------------- */
document.getElementById('btn-reset').addEventListener('click', () => {
  if(!confirm('¿Querés reiniciar todos los estados? Esta acción no se puede deshacer.')) return;
  localStorage.removeItem(STORAGE_KEY);
  updateUI();
});

document.getElementById('btn-reset-panel').addEventListener('click', () => {
  if(!confirm('¿Borrar todos los estados?')) return;
  localStorage.removeItem(STORAGE_KEY);
  updateUI();
});

/* ----------------------- INICIALIZACIÓN ----------------------- */
placeSubjects();
attachEventsToSubjects();
updateUI();

/* Refrescar UI si cambia localStorage en otra pestaña */
window.addEventListener('storage', (e)=>{
  if(e.key === STORAGE_KEY) updateUI();
});

/* Utilidad para re-render si se agregan materias dinámicamente */
function refreshAll(){
  placeSubjects();
  attachEventsToSubjects();
  updateUI();
}
</script>
</body>
</html>


